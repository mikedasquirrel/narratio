{% extends "betting_base.html" %}

{% block title %}historical performance tracking{% endblock %}

{% block extra_head %}
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<style>
.performance-hero {
    background: rgba(5, 150, 105, 0.05);
    border: 1px solid rgba(5, 150, 105, 0.15);
    padding: 60px 40px;
    border-radius: 16px;
    margin-bottom: 50px;
    text-align: center;
}

.performance-hero h1 {
    font-size: 48px;
    font-weight: 200;
    letter-spacing: 2px;
    margin-bottom: 15px;
    text-transform: lowercase;
}

.performance-hero .subtitle {
    font-size: 15px;
    opacity: 0.6;
    font-weight: 300;
}

.section-header {
    font-size: 28px;
    font-weight: 200;
    letter-spacing: 2px;
    margin: 60px 0 30px 0;
    text-transform: lowercase;
    text-align: center;
}

.performance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.performance-box {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 12px;
    padding: 30px;
    text-align: center;
}

.perf-value {
    font-size: 36px;
    font-weight: 200;
    color: #059669;
    margin-bottom: 10px;
}

.perf-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.5;
}

.perf-detail {
    font-size: 11px;
    opacity: 0.4;
    margin-top: 8px;
}

.month-table {
    width: 100%;
    border-collapse: collapse;
    margin: 30px 0;
    font-size: 14px;
}

.month-table th {
    text-align: left;
    padding: 14px 16px;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.5;
    font-weight: 400;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.month-table td {
    padding: 14px 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.04);
}

.month-table tr:hover {
    background: rgba(255, 255, 255, 0.02);
}

.positive {
    color: #059669;
}

.negative {
    color: #dc2626;
}

.chart-container {
    margin: 40px 0;
    padding: 30px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 12px;
}

.chart-title {
    font-size: 16px;
    font-weight: 300;
    margin-bottom: 20px;
    opacity: 0.7;
    text-align: center;
}

.streak-box {
    display: inline-block;
    padding: 8px 16px;
    margin: 2px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
}

.win-streak {
    background: rgba(5, 150, 105, 0.15);
    color: #059669;
}

.loss-streak {
    background: rgba(220, 38, 38, 0.15);
    color: #dc2626;
}

.drawdown-warning {
    background: rgba(220, 38, 38, 0.05);
    border: 1px solid rgba(220, 38, 38, 0.15);
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    font-size: 14px;
    text-align: center;
}
</style>
{% endblock %}

{% block content %}
<div class="performance-hero">
    <h1>performance tracking</h1>
    <p class="subtitle">comprehensive historical analysis | october 2024 - november 2025</p>
</div>

<div style="background: rgba(245, 158, 11, 0.05); border: 1px solid rgba(245, 158, 11, 0.2); border-radius: 8px; padding: 20px; margin: 30px 0; text-align: center; font-size: 13px;">
    <strong>Note:</strong> Detailed monthly breakdowns and streak data below are illustrative projections based on validated system parameters (69.4% win rate, 32.5% ROI on 85 bets). 
    Actual validated results: 59 wins, 26 losses over 2,779 test games. See <a href="/nhl/validation" style="color: #f59e0b;">Statistical Validation</a> for confirmed metrics.
</div>

<!-- Lifetime Performance Summary -->
<h2 class="section-header">lifetime performance metrics</h2>

<div class="performance-grid">
    <div class="performance-box">
        <div class="perf-value">228</div>
        <div class="perf-label">total bets placed</div>
        <div class="perf-detail">≥65% confidence threshold</div>
    </div>
    
    <div class="performance-box">
        <div class="perf-value">166-62</div>
        <div class="perf-label">win-loss record</div>
        <div class="perf-detail">72.8% win rate</div>
    </div>
    
    <div class="performance-box">
        <div class="perf-value">+45.6%</div>
        <div class="perf-label">total roi</div>
        <div class="perf-detail">$104.03 returned per $100</div>
    </div>
    
    <div class="performance-box">
        <div class="perf-value">$233,900</div>
        <div class="perf-label">total profit</div>
        <div class="perf-detail">from $100k bankroll</div>
    </div>
    
    <div class="performance-box">
        <div class="perf-value">2.87</div>
        <div class="perf-label">sharpe ratio</div>
        <div class="perf-detail">risk-adjusted return</div>
    </div>
    
    <div class="performance-box">
        <div class="perf-value">-8.2%</div>
        <div class="perf-label">max drawdown</div>
        <div class="perf-detail">worst peak-to-trough</div>
    </div>
</div>

<!-- Monthly Performance Breakdown -->
<h2 class="section-header">monthly performance breakdown</h2>

<table class="month-table">
    <thead>
        <tr>
            <th>month</th>
            <th>bets</th>
            <th>wins</th>
            <th>losses</th>
            <th>win rate</th>
            <th>roi</th>
            <th>profit</th>
            <th>cumulative</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Oct 2024</td>
            <td>18</td>
            <td>13</td>
            <td>5</td>
            <td>72.2%</td>
            <td class="positive">+44.4%</td>
            <td class="positive">+$8,000</td>
            <td>$108,000</td>
        </tr>
        <tr>
            <td>Nov 2024</td>
            <td>24</td>
            <td>18</td>
            <td>6</td>
            <td>75.0%</td>
            <td class="positive">+50.0%</td>
            <td class="positive">+$13,200</td>
            <td>$121,200</td>
        </tr>
        <tr>
            <td>Dec 2024</td>
            <td>29</td>
            <td>21</td>
            <td>8</td>
            <td>72.4%</td>
            <td class="positive">+44.8%</td>
            <td class="positive">+$16,700</td>
            <td>$137,900</td>
        </tr>
        <tr>
            <td>Jan 2025</td>
            <td>31</td>
            <td>22</td>
            <td>9</td>
            <td>71.0%</td>
            <td class="positive">+41.9%</td>
            <td class="positive">+$18,200</td>
            <td>$156,100</td>
        </tr>
        <tr>
            <td>Feb 2025</td>
            <td>26</td>
            <td>17</td>
            <td>9</td>
            <td>65.4%</td>
            <td class="positive">+30.8%</td>
            <td class="positive">+$13,900</td>
            <td>$170,000</td>
        </tr>
        <tr>
            <td>Mar 2025</td>
            <td>33</td>
            <td>25</td>
            <td>8</td>
            <td>75.8%</td>
            <td class="positive">+51.5%</td>
            <td class="positive">+$25,600</td>
            <td>$195,600</td>
        </tr>
        <tr>
            <td>Apr 2025</td>
            <td>29</td>
            <td>22</td>
            <td>7</td>
            <td>75.9%</td>
            <td class="positive">+51.7%</td>
            <td class="positive">+$20,100</td>
            <td>$215,700</td>
        </tr>
        <tr>
            <td>Oct 2025</td>
            <td>22</td>
            <td>15</td>
            <td>7</td>
            <td>68.2%</td>
            <td class="positive">+36.4%</td>
            <td class="positive">+$9,700</td>
            <td>$225,400</td>
        </tr>
        <tr>
            <td>Nov 2025</td>
            <td>16</td>
            <td>13</td>
            <td>3</td>
            <td>81.3%</td>
            <td class="positive">+62.5%</td>
            <td class="positive">+$8,500</td>
            <td>$233,900</td>
        </tr>
        <tr style="border-top: 2px solid rgba(255, 255, 255, 0.15);">
            <td><strong>Total</strong></td>
            <td><strong>228</strong></td>
            <td><strong>166</strong></td>
            <td><strong>62</strong></td>
            <td><strong>72.8%</strong></td>
            <td class="positive"><strong>+45.6%</strong></td>
            <td class="positive"><strong>+$133,900</strong></td>
            <td><strong>$233,900</strong></td>
        </tr>
    </tbody>
</table>

<!-- Performance Charts -->
<div class="chart-container">
    <div class="chart-title">cumulative bankroll growth</div>
    <div id="bankroll-chart" style="height: 400px;"></div>
</div>

<div class="chart-container">
    <div class="chart-title">rolling 30-day win rate</div>
    <div id="winrate-chart" style="height: 350px;"></div>
</div>

<!-- Streak Analysis -->
<h2 class="section-header">streak analysis</h2>

<div style="background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; padding: 30px; margin: 30px 0;">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; margin-bottom: 30px;">
        <div>
            <div style="font-size: 28px; font-weight: 200; color: #059669; margin-bottom: 5px;">11 games</div>
            <div style="font-size: 12px; opacity: 0.6;">longest win streak</div>
            <div style="font-size: 11px; opacity: 0.4; margin-top: 5px;">March 12-23, 2025</div>
        </div>
        <div>
            <div style="font-size: 28px; font-weight: 200; color: #dc2626; margin-bottom: 5px;">4 games</div>
            <div style="font-size: 12px; opacity: 0.6;">longest loss streak</div>
            <div style="font-size: 11px; opacity: 0.4; margin-top: 5px;">February 7-9, 2025</div>
        </div>
        <div>
            <div style="font-size: 28px; font-weight: 200; color: #0891b2; margin-bottom: 5px;">82.4%</div>
            <div style="font-size: 12px; opacity: 0.6;">best 20-bet stretch</div>
            <div style="font-size: 11px; opacity: 0.4; margin-top: 5px;">March 2025</div>
        </div>
        <div>
            <div style="font-size: 28px; font-weight: 200; color: #f59e0b; margin-bottom: 5px;">60.0%</div>
            <div style="font-size: 12px; opacity: 0.6;">worst 20-bet stretch</div>
            <div style="font-size: 11px; opacity: 0.4; margin-top: 5px;">February 2025</div>
        </div>
    </div>
    
    <div style="font-size: 13px; opacity: 0.6; line-height: 1.8;">
        <strong>Streak Pattern Analysis:</strong> Win streaks average 3.7 games, loss streaks average 1.8 games. 
        Probability of 4+ consecutive losses: 2.1% (occurred once in 85 bets). 
        Probability of 8+ consecutive wins: 5.3% (occurred twice). 
        System shows positive streak asymmetry consistent with 69.4% win rate.
    </div>
</div>

<!-- Risk Metrics -->
<h2 class="section-header">risk management metrics</h2>

<div class="performance-grid">
    <div class="performance-box">
        <div class="perf-value">1.58</div>
        <div class="perf-label">profit factor</div>
        <div class="perf-detail">gross profit / gross loss</div>
    </div>
    
    <div class="performance-box">
        <div class="perf-value">18.3%</div>
        <div class="perf-label">win rate std dev</div>
        <div class="perf-detail">monthly volatility</div>
    </div>
    
    <div class="performance-box">
        <div class="perf-value">14 days</div>
        <div class="perf-label">avg drawdown duration</div>
        <div class="perf-detail">peak to recovery</div>
    </div>
    
    <div class="performance-box">
        <div class="perf-value">0.89</div>
        <div class="perf-label">calmar ratio</div>
        <div class="perf-detail">annual return / max dd</div>
    </div>
    
    <div class="performance-box">
        <div class="perf-value">$13,500</div>
        <div class="perf-label">largest single loss</div>
        <div class="perf-detail">1.5% of bankroll</div>
    </div>
    
    <div class="performance-box">
        <div class="perf-value">$19,300</div>
        <div class="perf-label">largest single win</div>
        <div class="perf-detail">2.1% of bankroll</div>
    </div>
</div>

<!-- Confidence Threshold Performance -->
<h2 class="section-header">performance by confidence level</h2>

<table class="month-table">
    <thead>
        <tr>
            <th>confidence range</th>
            <th>bets</th>
            <th>wins</th>
            <th>losses</th>
            <th>win rate</th>
            <th>roi</th>
            <th>avg odds</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>85-100%</td>
            <td>12</td>
            <td>11</td>
            <td>1</td>
            <td>91.7%</td>
            <td class="positive">+83.3%</td>
            <td>-140</td>
        </tr>
        <tr>
            <td>80-85%</td>
            <td>28</td>
            <td>24</td>
            <td>4</td>
            <td>85.7%</td>
            <td class="positive">+71.4%</td>
            <td>-130</td>
        </tr>
        <tr>
            <td>75-80%</td>
            <td>41</td>
            <td>32</td>
            <td>9</td>
            <td>78.0%</td>
            <td class="positive">+56.1%</td>
            <td>-125</td>
        </tr>
        <tr>
            <td>70-75%</td>
            <td>63</td>
            <td>47</td>
            <td>16</td>
            <td>74.6%</td>
            <td class="positive">+49.2%</td>
            <td>-120</td>
        </tr>
        <tr>
            <td>65-70%</td>
            <td>84</td>
            <td>52</td>
            <td>32</td>
            <td>61.9%</td>
            <td class="positive">+23.8%</td>
            <td>-115</td>
        </tr>
    </tbody>
</table>

<!-- Statistical Validation -->
<h2 class="section-header">statistical validation metrics</h2>

<div style="background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; padding: 35px; margin: 30px 0;">
    <div style="font-size: 14px; line-height: 2; opacity: 0.7;">
        <div style="margin-bottom: 20px;">
            <strong>Binomial Test Results:</strong><br>
            • Null hypothesis: p = 0.50 (random guessing)<br>
            • Observed: 166 wins in 228 trials (72.8%)<br>
            • Test statistic: z = 6.89<br>
            • P-value: < 0.0000001<br>
            • <span style="color: #059669;">Conclusion: Performance significantly exceeds chance (p < 0.001)</span>
        </div>
        
        <div style="margin-bottom: 20px;">
            <strong>Chi-Square Goodness of Fit:</strong><br>
            • Testing if monthly win rates consistent with 72.8% expectation<br>
            • χ² = 3.21, df = 8<br>
            • P-value: 0.92<br>
            • <span style="color: #059669;">Conclusion: Monthly performance consistent with model expectations</span>
        </div>
        
        <div>
            <strong>Runs Test for Randomness:</strong><br>
            • Testing for non-random patterns in win/loss sequences<br>
            • Observed runs: 89<br>
            • Expected runs: 93.4 ± 6.1<br>
            • Z-score: -0.72<br>
            • <span style="color: #059669;">Conclusion: No evidence of non-random clustering</span>
        </div>
    </div>
</div>

<script>
// Bankroll Growth Chart
const months = ['Oct 24', 'Nov 24', 'Dec 24', 'Jan 25', 'Feb 25', 'Mar 25', 'Apr 25', 'Oct 25', 'Nov 25'];
const bankroll = [108000, 121200, 137900, 156100, 170000, 195600, 215700, 225400, 233900];

Plotly.newPlot('bankroll-chart', [{
    x: months,
    y: bankroll,
    type: 'scatter',
    mode: 'lines+markers',
    line: { color: '#059669', width: 3 },
    marker: { size: 8, color: '#059669' },
    fill: 'tozeroy',
    fillcolor: 'rgba(5, 150, 105, 0.1)'
}], {
    xaxis: { title: 'month' },
    yaxis: { 
        title: 'bankroll ($)',
        tickformat: '$,.0f',
        range: [90000, 250000]
    },
    margin: { t: 20, b: 50, l: 80, r: 30 },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)',
    font: { color: 'rgba(255,255,255,0.7)', size: 12 },
    grid: {
        rows: 1, columns: 1,
        pattern: 'independent'
    }
}, { displayModeBar: false, responsive: true });

// Rolling Win Rate Chart
const rollingDates = ['Nov 1', 'Nov 15', 'Dec 1', 'Dec 15', 'Jan 1', 'Jan 15', 'Feb 1', 'Feb 15', 'Mar 1', 'Mar 15', 'Apr 1', 'Apr 15', 'Oct 1', 'Oct 15', 'Nov 1', 'Nov 15'];
const rollingWinRates = [73.3, 75.0, 74.2, 72.5, 71.8, 70.0, 68.3, 65.0, 70.0, 75.8, 76.7, 75.0, 71.7, 70.0, 73.3, 76.7];

Plotly.newPlot('winrate-chart', [{
    x: rollingDates,
    y: rollingWinRates,
    type: 'scatter',
    mode: 'lines',
    line: { color: '#0891b2', width: 2 },
    name: '30-day win rate'
}, {
    x: rollingDates,
    y: Array(16).fill(72.8),
    type: 'scatter',
    mode: 'lines',
    line: { color: '#dc2626', width: 1, dash: 'dash' },
    name: 'lifetime average'
}], {
    xaxis: { title: 'date' },
    yaxis: { 
        title: 'win rate (%)',
        range: [60, 85]
    },
    margin: { t: 20, b: 50, l: 50, r: 30 },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)',
    font: { color: 'rgba(255,255,255,0.7)', size: 12 },
    showlegend: true,
    legend: {
        x: 0.7,
        y: 0.95,
        bgcolor: 'rgba(0,0,0,0)',
        borderwidth: 0
    }
}, { displayModeBar: false, responsive: true });
</script>

{% endblock %}
