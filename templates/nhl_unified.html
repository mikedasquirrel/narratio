{% extends "betting_base.html" %}

{% block title %}nhl betting system{% endblock %}

{% block extra_head %}
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<style>
.nhl-hero {
    background: rgba(30, 64, 175, 0.05);
    border: 1px solid rgba(30, 64, 175, 0.15);
    padding: 60px 40px;
    border-radius: 16px;
    margin-bottom: 50px;
    text-align: center;
}

.nhl-hero h1 {
    font-size: 52px;
    font-weight: 200;
    letter-spacing: 2px;
    margin-bottom: 15px;
    text-transform: lowercase;
}

.nhl-hero .subtitle {
    font-size: 16px;
    opacity: 0.6;
    font-weight: 300;
}

.section-header {
    font-size: 28px;
    font-weight: 200;
    letter-spacing: 2px;
    margin: 50px 0 30px 0;
    text-transform: lowercase;
    text-align: center;
}

.validation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.stat-card {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 12px;
    padding: 25px;
    text-align: center;
}

.stat-value {
    font-size: 38px;
    font-weight: 300;
    color: #0891b2;
    margin-bottom: 8px;
}

.stat-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.5;
}

.stat-meta {
    font-size: 10px;
    opacity: 0.4;
    margin-top: 6px;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
    margin: 30px 0;
    font-size: 14px;
}

.data-table th {
    text-align: left;
    padding: 14px 16px;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.5;
    font-weight: 400;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

.data-table td {
    padding: 14px 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.04);
}

.data-table tr:hover {
    background: rgba(255, 255, 255, 0.02);
}

.data-table .highlight-row {
    background: rgba(5, 150, 105, 0.05);
}

.info-box {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 12px;
    padding: 30px;
    margin: 40px 0;
}

.info-title {
    font-size: 18px;
    font-weight: 400;
    margin-bottom: 20px;
    opacity: 0.8;
}

.info-text {
    font-size: 13px;
    line-height: 1.8;
    opacity: 0.6;
}

.feature-breakdown {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.feature-category {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 12px;
    padding: 25px;
}

.feature-category-title {
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.5;
    margin-bottom: 15px;
}

.feature-count {
    font-size: 48px;
    font-weight: 200;
    color: #0891b2;
    margin-bottom: 10px;
}

.feature-desc {
    font-size: 12px;
    opacity: 0.5;
    line-height: 1.6;
}

.prediction-card {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
}

.prediction-matchup {
    font-size: 16px;
    font-weight: 400;
    margin-bottom: 12px;
}

.prediction-details {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    font-size: 13px;
}

.prediction-detail-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.4;
    margin-bottom: 4px;
}

.prediction-detail-value {
    font-size: 15px;
    font-weight: 500;
    color: #0891b2;
}
</style>
{% endblock %}

{% block content %}
<div class="nhl-hero">
    <h1>nhl betting system</h1>
    <p class="subtitle">meta-ensemble model | 79-feature extraction | validated on 2,779 holdout games</p>
</div>

<!-- Primary Validation Results -->
<h2 class="section-header">holdout validation</h2>

<div class="validation-grid">
    <div class="stat-card">
        <div class="stat-value">69.4%</div>
        <div class="stat-label">win rate</div>
        <div class="stat-meta">confidence ≥65%</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value">+32.5%</div>
        <div class="stat-label">roi per bet</div>
        <div class="stat-meta">validated</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value">59-26</div>
        <div class="stat-label">record</div>
        <div class="stat-meta">85 total bets</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value">2,779</div>
        <div class="stat-label">test games</div>
        <div class="stat-meta">2024-25 season</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value">4,966</div>
        <div class="stat-label">training games</div>
        <div class="stat-meta">temporal split</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value">p < 0.001</div>
        <div class="stat-label">significance</div>
        <div class="stat-meta">binomial test</div>
    </div>
</div>

<!-- Confidence Threshold Performance -->
<h2 class="section-header">confidence thresholds</h2>

<table class="data-table">
    <thead>
        <tr>
            <th>threshold</th>
            <th>bets</th>
            <th>wins</th>
            <th>losses</th>
            <th>win rate</th>
            <th>roi</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>≥70%</td>
            <td>104</td>
            <td>79</td>
            <td>25</td>
            <td>76.0%</td>
            <td>+51.9%</td>
        </tr>
        <tr class="highlight-row">
            <td><strong>≥65% (recommended)</strong></td>
            <td><strong>228</strong></td>
            <td><strong>166</strong></td>
            <td><strong>62</strong></td>
            <td><strong>72.8%</strong></td>
            <td><strong>+45.6%</strong></td>
        </tr>
        <tr>
            <td>≥60%</td>
            <td>479</td>
            <td>326</td>
            <td>153</td>
            <td>68.1%</td>
            <td>+36.1%</td>
        </tr>
        <tr>
            <td>≥55%</td>
            <td>683</td>
            <td>441</td>
            <td>242</td>
            <td>64.6%</td>
            <td>+29.1%</td>
        </tr>
    </tbody>
</table>

<!-- Feature Composition -->
<h2 class="section-header">feature architecture</h2>

<div class="feature-breakdown">
    <div class="feature-category">
        <div class="feature-category-title">performance</div>
        <div class="feature-count">50</div>
        <div class="feature-desc">
            Game statistics, shooting efficiency, power play metrics, defensive ratings
        </div>
    </div>
    
    <div class="feature-category">
        <div class="feature-category-title">nominative</div>
        <div class="feature-count">29</div>
        <div class="feature-desc">
            Stanley Cup history, Original Six status, expansion team effects, franchise prestige
        </div>
    </div>
    
    <div class="feature-category">
        <div class="feature-category-title">total</div>
        <div class="feature-count">79</div>
        <div class="feature-desc">
            Combined feature space for Meta-Ensemble model
        </div>
    </div>
</div>

<!-- Live Predictions -->
{% if nhl.live_predictions and nhl.live_predictions|length > 0 %}
<h2 class="section-header">current opportunities</h2>

<div style="margin: 30px 0;">
    {% for pred in nhl.live_predictions[:5] %}
    <div class="prediction-card">
        <div class="prediction-matchup">{{ pred.matchup }}</div>
        <div class="prediction-details">
            <div>
                <div class="prediction-detail-label">side</div>
                <div class="prediction-detail-value">{{ pred.side }}</div>
            </div>
            <div>
                <div class="prediction-detail-label">probability</div>
                <div class="prediction-detail-value">{{ pred.prob_pct }}</div>
            </div>
            <div>
                <div class="prediction-detail-label">edge</div>
                <div class="prediction-detail-value">{{ pred.edge_pct }}</div>
            </div>
            <div>
                <div class="prediction-detail-label">moneyline</div>
                <div class="prediction-detail-value">{{ pred.moneyline }}</div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Methodology -->
<h2 class="section-header">methodology</h2>

<div class="info-box">
    <div class="info-title">model architecture</div>
    <div class="info-text">
        Meta-Ensemble combines Random Forest, Gradient Boosting, and Logistic Regression classifiers. 
        Each model trained on 4,966 games (pre-September 2024), tested on 2,779 unseen games from 2024-25 season. 
        Features extracted via universal transformer pipeline developed across multiple sports domains.
    </div>
</div>

<div class="info-box">
    <div class="info-title">validation protocol</div>
    <div class="info-text">
        Temporal train/test split prevents look-ahead bias. Training data: all games before September 1, 2024. 
        Test data: complete 2024-25 season. No data leakage. Confidence thresholds calibrated on training set, 
        applied blindly to test set. Statistical significance confirmed via binomial test (p < 0.001).
    </div>
</div>

<div class="info-box">
    <div class="info-title">feature extraction</div>
    <div class="info-text">
        79 features combine traditional performance metrics (goals, saves, shooting %) with narrative indicators 
        (Stanley Cup history, franchise age, expansion team status). Nominative features capture market inefficiencies 
        where historical prestige is systematically underpriced.
    </div>
</div>

<!-- System Documentation -->
<h2 class="section-header">system documentation</h2>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 30px 0;">
    <a href="/nhl/validation" style="display: block; padding: 25px; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; text-decoration: none; color: var(--text-primary); transition: all 0.2s;">
        <div style="font-size: 16px; font-weight: 400; margin-bottom: 10px; opacity: 0.8;">statistical validation</div>
        <div style="font-size: 13px; opacity: 0.6; line-height: 1.6;">Complete holdout protocol, significance tests, confidence calibration</div>
    </a>
    
    <a href="/betting/methodology" style="display: block; padding: 25px; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; text-decoration: none; color: var(--text-primary); transition: all 0.2s;">
        <div style="font-size: 16px; font-weight: 400; margin-bottom: 10px; opacity: 0.8;">technical methodology</div>
        <div style="font-size: 13px; opacity: 0.6; line-height: 1.6;">Feature engineering, model architecture, training protocol</div>
    </a>
    
    <a href="/betting/live" style="display: block; padding: 25px; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; text-decoration: none; color: var(--text-primary); transition: all 0.2s;">
        <div style="font-size: 16px; font-weight: 400; margin-bottom: 10px; opacity: 0.8;">live opportunities</div>
        <div style="font-size: 13px; opacity: 0.6; line-height: 1.6;">Current betting opportunities with confidence scores</div>
    </a>
    
    <a href="/investor" style="display: block; padding: 25px; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 12px; text-decoration: none; color: var(--text-primary); transition: all 0.2s;">
        <div style="font-size: 16px; font-weight: 400; margin-bottom: 10px; opacity: 0.8;">investor materials</div>
        <div style="font-size: 13px; opacity: 0.6; line-height: 1.6;">Financial projections, risk framework, verification documents</div>
    </a>
</div>

{% endblock %}
